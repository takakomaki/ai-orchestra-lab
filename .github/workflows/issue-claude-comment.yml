name: Claude issue assistant

on:
  issues:
    types: [labeled]

permissions:
  issues: write

jobs:
  claude-comment:
    # ãƒ©ãƒ™ãƒ«ã« "Claude" ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã¨ãã ã‘å®Ÿè¡Œ
    if: contains(join(fromJson(toJson(github.event.issue.labels)).*.name, ','), 'Claude')
    runs-on: ubuntu-latest

    steps:
      - name: Debug Claude workflow
        run: |
          echo "âœ… Claude workflow is running"
          echo "Issue number: ${{ github.event.issue.number }}"
          echo "Issue title:  ${{ github.event.issue.title }}"

      - name: Call Claude and post comment
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_BODY: ${{ github.event.issue.body }}
          REPO: ${{ github.repository }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
        run: |
          echo "ğŸ”” Calling Claude..."

          # 1) ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¨æ–‡ã‚’Bashå´ã§çµ„ã¿ç«‹ã¦ã‚‹
          PROMPT="$(cat << EOF
ã‚ãªãŸ
